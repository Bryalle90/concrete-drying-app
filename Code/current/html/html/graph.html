<!--
Author: Daniel Grote
file - graph.html
uses: 


Desc: This file generates the graph
-->

<!--Add Notfication Button. onSubmit check to make sure it is the orginal data -->
<!--$_POST['projectID'] if set thats project. 
<!--Container that the chart is in -->
<div class="bs-example">
    <div class="alert alert-success" id='notifSuccess' role="alert">
        <a href="#" class="close" >&times;</a>
        <strong>Success!</strong> Your notification has successfully been saved.
    </div>
</div>
<div class="bs-example">
    <div class="alert alert-success" id='emailSuccess' role="alert">
        <a href="#" class="close">&times;</a>
        <strong>Success!</strong> Your E-mail has succesfully been sent.
    </div>
</div>


<?php
if(isset($_POST['projectID'])){
	?>
	<script> var isProject = true;</script>
	<?php
	$projectID = $_POST['projectID'];
	include($_SERVER['DOCUMENT_ROOT'].'/classes/DbProject.php');
	$projectdb= new DbProject();
	$name = $projectdb->getName($_POST['projectID']);
	?>
	<script>
	var projectID = (<?php echo json_encode($projectID)?>);
	var projectName = (<?php echo json_encode($name)?>);
	var yLevel = 30;
	
	</script>
	<?php
	
}
else {
	?>
	<script>
	var isProject = false;
	var projectName = null;
	var yLevel = 5;
	</script>
	<?php
}
?>

<div id="report"></div>
<div id="container" style="height:70vh; min-height:400px; min-width: 1050px;"></div>

<script>

	
	var currentZone;
	var notifTimeID;
	var seriesNotifID;
	var coldWeatherConcTemp = 49;
	var hotWeatherConcTemp = 85;
	var numberOfSeries = 1;
	var concTempArray = main.getConcreteTempArray();
	var cTempOffset = null;
	var windOffset = null;
	var city = main.getCity();
	var state = main.getState();
	var resetButton = false;
	
	var plotBandUpperBoundary = 5.0000;
	var plotBandRedYellowBoundary = 0.2001;
	var plotBandYellowGreenBoundary = 0.1501
	var plotBandLowerBoundary = -5.0000
	
	var ModerateRiskBoundary = 0.20;
	var lowRiskBoundary = 0.15;
	
$(function () {
	
	//Weather Data Arrays
	var evapArray = main.getEvapArray();
	var originalEvapArray = evapArray;
	var airTempArray = main.getAirTempArray();
	var userConcreteTempArray = {};
	var humidityArray = main.getHumidityArray();
	var timeArray = main.getTimeArray();
	var cloudCoverArray = main.getCloudCoverArray();
	var windSpeedArray = main.getWindSpeedArray();
	var originalWindSpeedArray = windSpeedArray;

	var zipCode = main.getZipCode();
	//var zipCode = Math.floor(Math.random()*90000) + 10000;
	var isMetric = main.isMetric();	
	var arrayLength = evapArray.length;
	var isOrignalGraph = true;

	var timezone = 'Local time of ' + city + ', ' + state;
	
	//These colors are used for the plotbands and tooltip borders
	var red = 'rgba(255, 0, 0, 0.8)';
	var yellow = 'rgba(255,255,0,.85)';
	var green = 'rgba(0, 226, 0, 0.7)';
	var tmpColor = ''

	var lowerBoundConcreteTemp = '';
	var upperBoundConcreteTemp = '';
	var lowerBoundWindSpeed = '';
	var upperBoundWindSpeed = '';
	
	var pointsSelected = [];
	var insideWindSpeed = []
	
	//Date and time variables
	var monthname = new Array();
	monthname[0] = "January";
	monthname[1] = "February";
	monthname[2] = "March";
	monthname[3] = "April";
	monthname[4] = "May";
	monthname[5] = "June";
	monthname[6] = "July";
	monthname[7] = "August";
	monthname[8] = "September";
	monthname[9] = "October";
	monthname[10] = "November";
	monthname[11] = "December";
	
	var weekday = new Array(7);
	weekday[0] = "Sun";
	weekday[1] = "Mon";
	weekday[2] = "Tues";
	weekday[3] = "Wed";
	weekday[4] = "Thur";
	weekday[5] = "Fri";
	weekday[6] = "Sat";
	
	var year = [];
	var day = [];
	var hour = [];
	var month = [];
	var nameOfMonth = [];
	var nameOfDay = [];

	//Labels
	var yaxislabel = "Evaporation Rate";
	var evaporationRateLabel = "";
	var temperatureLabel = "";
	var windLabel = "";
	if (projectName == null) {
		var title = city + ', ' + state + ' ' + zipCode;
	}
	else if (projectName != null) {
		var title = 'Project: ' + projectName + '<br>' +city + ', ' + state + ' ' + zipCode;
	}
	//var title = city + ', ' + state + ' ' + zipCode;
	
	//Add suffixes of labels 
	//If metric assign metric labels
	if (isMetric)
	{
		yaxislabel += " (kg/m\xB2/hr)";
		evaporationRateLabel = ' kg/m'+'\xB2'+'/hr</b>';
		temperatureLabel = '\xB0'+'C';
		windLabel = 'kph';
		
		lowerBoundConcreteTemp = 4.4;
		upperBoundConcreteTemp = 37.2;
		lowerBoundWindSpeed = 0.0;
		upperBoundWindSpeed = 56.3;
		
	
	
		for (i = 0; i< arrayLength; i++)
		{
			insideWindSpeed[i] = 1.61;
		}
	}

	//else standard
	else
	{
		yaxislabel += " (lb/ft\xB2/hr)";
		evaporationRateLabel = ' lb/ft'+'\xB2'+'/hr </b> ';
		temperatureLabel = '\xB0'+'F';
		windLabel = 'mph';
		lowerBoundConcreteTemp = 40.0;
		upperBoundConcreteTemp = 130.0;
		lowerBoundWindSpeed = 0.0;
		upperBoundWindSpeed = 54.4;
		
		for (i = 0; i< arrayLength; i++)
		{
			insideWindSpeed[i] = 1;
		}
		
	}
	
	document.getElementById("concreteTemp").min = lowerBoundConcreteTemp;
	document.getElementById("concreteTemp").max = upperBoundConcreteTemp;
	document.getElementById("cTempLabel").innerHTML = temperatureLabel;

	
	//Format dates and times
	for (var i=0; i<arrayLength; i++)
	{
		var string = timeArray[i];
		var partsArray = string.split('-');
		year[i] = partsArray[0];
		month[i] = partsArray[1];
		day[i] = partsArray[2];
		hour[i] = partsArray[3];

		var d = new Date(partsArray[0], ((partsArray[1]) - 1), partsArray[2], partsArray[3], 0, 0, 0);

		//Convert 24 hour time to 12 hour time
		/*
		if (hour[i] > 12)
		{
			hour[i] = (hour[i] - 12)+ 'PM';// PM';
		}
		
		else if (hour[i] == 0 )
		{
			hour[i] = 12 + 'AM';
			//+ ':00 AM';
		}

		else if (hour[i] == 12)
		{
			hour[i] = 'Noon';
		}
		
		else
		{
			//Subtracting 0 formats date correctly.
			hour[i] = (hour[i] - 0) + 'AM';
			//+ ':00 AM';
		}
		*/
		year[i] = d.getFullYear().toString().substr(2,2);
		nameOfMonth[i] = monthname[d.getMonth()];
		nameOfDay[i] = weekday[d.getDay()];
	}

	var subtitle = nameOfMonth[0] + " " + day[0] + " - "+ nameOfMonth[nameOfMonth.length - 1] + " " + day[day.length - 1];

	//Labels for x-axis
	var labelDate = [];
	var fullDate = [];
	groupedLabels = [];
	d = []
	
	var j=0;
	var x=0;
	dayName = [];
	dayName[0] = nameOfDay[0];
	var zero = [];
	var one = [];
	var two = [];
	var three = [];
	var four = [];
	var five = [];
	var six = [];
	var seven = [];
	zero[0] = hour[0];
	//Set Labels for x-axis
	fullDate[0] = nameOfDay[0] + " " + nameOfMonth[0] + " " + day[0] + " " + hour[0] + ":00";

	labelDate[0] = hour[0] +", "+ nameOfDay[0];
	
	for (var i = 1; i < arrayLength; i++)
	{
		fullDate[i] = nameOfDay[i] + " " + nameOfMonth[i] + " " + day[i] + " " + hour[i] + ":00";
		labelDate[i] = hour[i] +", "+ nameOfDay[i];
	
		if (nameOfDay[i] == nameOfDay[i-1])
		{
			x += 1;
			if (j == 0)
			{
				zero[x] = hour[i];
			}
			
			if (j == 1)
			{
				one[x] = hour[i];
			}
			
			if (j == 2)
			{
				two[x] = hour[i];
			}
			
			if (j == 3)
			{
				three[x] = hour[i];
			}
			
			if (j == 4)
			{
				four[x] = hour[i];
			}
			
			if (j == 5)
			{
				five[x] = hour[i];
			}
			
			if (j == 6)
			{
				six[x] = hour[i];
			}
			
			if (j == 7)
			{
				seven[x] = hour[i];
			}
		}
		
		else
		{
			x = 0;
			j += 1;
			
			if (j == 0)
			{
				zero[0] = hour[i];
			}
			
			if (j == 1)
			{
				one[0] = hour[i];
			}
			
			if (j == 2)
			{
				two[0] = hour[i];
			}
			
			if (j == 3)
			{
				three[0] = hour[i];
			}
			
			if (j == 4)
			{
				four[0] = hour[i];
			}
			
			if (j == 5)
			{
				five[0] = hour[i];
			}
			
			if (j == 6)
			{
				six[0] = hour[i];
			}
			
			if (j == 7)
			{
				seven[0] = hour[i];
			}
			
			dayName[j] = nameOfDay[i]; 
		}
	
	
	}

	//Chart Configuration
	$('#container').highcharts
	({
		chart: {
			//type: 'scatter'
		},
		//title configuration
		title: 
		{
			text: title,
			 x: -40 //center
			 
		},

		//Subtitle configuration
		subtitle:
		{
			text: subtitle,
			x: -40 //center
		},

		//Legend configuration OFF
		legend:
		{
			title:
			{
				text: 'Predictions<br/><span style="font-size: 9px; color: #666; font-weight: normal">(Click to hide)</span>',
				style:
				{
					fontStyle: 'italic'
				}
			},
			enabled: true,
			align: 'right',
			verticalAlign: 'top',
			layout: 'vertical',
			y: 50,
			x: 10
			
		},

		//x-axis configuration
		xAxis:
		{
			minPadding: 0,
			maxPadding: 0,
			title:{
				text: timezone
			},
			
			//x axis labels
			categories:
			[{
				name: dayName[0],
				categories: zero
			},
			
			{
				name: dayName[1],
				categories: one
			},
			
			{
				name: dayName[2],
				categories: two
			},
			
			{
				name: dayName[3],
				categories: three
			},
			
			{
				name: dayName[4],
				categories: four
			},
			
			{
				name: dayName[5],
				categories: five
			},
		
			{
				name: dayName[6],
				categories: six
			},

			{
				name: dayName[7],
				categories: seven
			}],
			
			
			//x axis label configuration
			labels:
			{
				rotation: 0,

				style:
				{
					fontSize: '11px'
				},
			},
		},
		

		//Y axis configuration
		yAxis:
		{
			gridLineDashStyle: 'longdash',
			gridLineColor: 'black',
			minPadding: 0,
			maxPadding: 0,
			
			//Title of y-axis
			title:
			{
				text: yaxislabel
			},

			//Plot band configuration
			plotBands:
			[{
				//Green (low risk) plot band
				from: plotBandLowerBoundary,
				to: plotBandYellowGreenBoundary,
				color: green,
				//Green plot band title configuration
				label:
				{
					text: 'LOW RISK',
					align: 'center',
					style:
					{
						color: 'black',
						fontSize: '18px',
						fontWeight: 'bold'
					}
				}
			},

			{
				//Yellow (moderate risk) plot band
				from: plotBandYellowGreenBoundary,
				to: plotBandRedYellowBoundary,
				color: yellow,
				
				//Yellow plot band title configuration
				label:
				{
					text: 'MODERATE RISK',
					align: 'center',
					style:
					{
						color: 'black',
						fontSize: '18px',
						fontWeight: 'bold'
					}
				}
			},

			{
				//Red (high risk) plot band
				from: plotBandRedYellowBoundary,
				to: plotBandUpperBoundary,
				color: red,
				
				//Red plot band title configuration
				label:
				{
					text: 'HIGH RISK',
					align: 'center',
					style:
					{
						color: 'black',
						fontSize: '18px',
						fontWeight: 'bold'
					}
				}
			}]
		},
	
		//Tooltip Configuration
		tooltip:
		{
			//animation: false,
			//enabled: false,
			useHTML: true,
			//crosshair: [true, true],
			//shared: false,
			//snap: 40,
			stickyTracking: false,
			borderWidth: 0,
			//padding: 5,
			//z: 20,
			style:
			{
				padding: 0
			},

			//Tooltip Formatter
			formatter: function()
			{
				wind = [];
				concreteTemp = [];
				
				//var newSeries = this.series;
				//var index = $.inArray(this.x, labelDate);
				var index = this.point.series.xData.indexOf(this.point.x);
				
				//Sets border color of tooltip
				// If evap rate is over .2 then Red tooltip border
				if (this.y > ModerateRiskBoundary)
				{
					tmpColor = red;
				}
				
				//yellow border
				else if (this.y > lowRiskBoundary && this.y <= ModerateRiskBoundary)
				{
					tmpColor = yellow;
				}
				
				//Green border
				else
				{
					tmpColor = green;
				}
				
				if (this.series.name == 'Original Prediction')
				{
					wind = windSpeedArray;
					concreteTemp = concTempArray;
				}
				
				else if (this.series.name == 'Inside')
				{
					wind = insideWindSpeed;
					concreteTemp = concTempArray;
				}
				else if (this.series.name.length >= 26)
				{
					str = this.series.name
					if (isMetric) {
						
						newConcreteTemp = parseFloat(str.match(/[\d\.]+/))
						//newConcreteTemp = newConcreteTemp.join("");
					}
					else{
					
					newConcreteTemp = str.match(/\d/g);
					
					newConcreteTemp = newConcreteTemp.join("");
					}

					//Inside
					if (str.indexOf("Inside") > -1)
					
					{
						for (var i=0; i <arrayLength; i++)
						{
							concreteTemp[i] = newConcreteTemp;
							wind[i] = insideWindSpeed[i];
						}

					}
					
					//Outside
					else
					{
						//alert('asdfasdf');
						for (var i=0; i <arrayLength; i++)
						{
							concreteTemp[i] = newConcreteTemp;
							wind[i] = windSpeedArray[i];
						}

					}
					
				}
				
				var s = '<div style= "padding: 10px; border: 3px solid '+tmpColor+';">';
				s +='<b>'+ fullDate[index] +'</b>';
				s += '<br/> <b> Evaporation Rate: ' + main.round(this.y, 2) + evaporationRateLabel;
				s += '<br/>	\u2022 Temperature: ' + main.round(airTempArray[index], 2) + temperatureLabel;
				s += '<br/> \u2022 Concrete Temperature: ' + main.round(concreteTemp[index], 2) + temperatureLabel;
				s += '<br/>	\u2022 Wind: ' + main.round(wind[index], 2) + windLabel;
				s += '<br/>	\u2022 Relative Humidity: ' + humidityArray[index]+ '%';
				s += '<br/>	\u2022 Cloud Cover: ' + cloudCoverArray[index] +'%';
				
				// If standard
				if (isMetric == false)
				{
					//If evaporation rate has a high risk show concrete temperature to go from the high to moderate risk and from high to low risk
					if (this.y > ModerateRiskBoundary)
					{
						suggestedLowConcTemp = main.getLowerRiskTemp(lowRiskBoundary, wind[index], humidityArray[index], airTempArray[index] );						
						suggestedModConcTemp = main.getLowerRiskTemp(ModerateRiskBoundary, wind[index], humidityArray[index], airTempArray[index] );
						s+= '<br/> \u2022 Concrete temp needed for moderate risk: ' + main.round(suggestedModConcTemp, 2) + temperatureLabel;
						s+= '<br/> \u2022 Concrete temp needed for low risk: ' + main.round(suggestedLowConcTemp, 2) + temperatureLabel;

					}

					//If evaporationg rate has a moderate risk
					else if (this.y > lowRiskBoundary)
					{
						suggestedLowConcTemp = main.getLowerRiskTemp(lowRiskBoundary, wind[index], humidityArray[index], airTempArray[index] );	
						s+= '<br/> \u2022 Concrete temp needed for low risk: ' + main.round(suggestedLowConcTemp, 2) + temperatureLabel;
					}
					
					//Add hot/cold weather warnings
					if (concreteTemp[index] <= coldWeatherConcTemp) {
						s+= ' <br/> <div style = "color:red">Warning: Ambient temperatures require cold weather placement <br>techniques, see ACI 306 Guide to Cold Weather Concreting<div>';
					}
					else if (concreteTemp[index] >= hotWeatherConcTemp) {
						s+= ' <br/> <div style = "color:red">Warning: Ambient temperatures require hot weather placement <br>techniques, see ACI 305 Guide to Hot Weather Concreting<div>';
					}
				}//end if

				//else metric
				else
				{
					//If evaporation rate has a high risk
					if (this.y > ModerateRiskBoundary)
					{
						suggestedLowConcTemp = main.convertFtoC(main.getLowerRiskTemp(lowRiskBoundary, main.convertKphToMph(wind[index]), humidityArray[index], main.convertCtoF(airTempArray[index])));
						suggestedModConcTemp = main.convertFtoC(main.getLowerRiskTemp(ModerateRiskBoundary, main.convertKphToMph(wind[index]), humidityArray[index], main.convertCtoF(airTempArray[index])));			
						s+= '<br/> \u2022 Concrete temp needed for moderate risk: ' + main.round(suggestedModConcTemp, 2) + temperatureLabel;
						s+= '<br/> \u2022 Concrete temp needed for low risk:' + main.round(suggestedLowConcTemp, 2) + temperatureLabel;
					}

					//If evaporation rate has a moderate risk
					else if(this.y > lowRiskBoundary )
					{
						suggestedLowConcTemp = main.convertFtoC(main.getLowerRiskTemp(lowRiskBoundary, main.convertKphToMph(wind[index]), humidityArray[index], main.convertCtoF(airTempArray[index])));
						s+= '<br/> \u2022 Concrete temp needed for low risk: ' + main.round(suggestedLowConcTemp, 2) + temperatureLabel;
					}
					
					//Add hot/cold weather warnings
					if (main.convertCtoF(concreteTemp[index]) <= coldWeatherConcTemp) {
						s+= ' <br/> <div style = "color:red">Warning: Ambient temperatures require cold weather placement <br>techniques, see ACI 306 Guide to Cold Weather Concreting<div>';
					}
					else if (main.convertCtoF(concreteTemp[index]) >= hotWeatherConcTemp) {
						s+= ' <br/> <div style = "color:red">Warning: Ambient temperatures require hot weather placement <br>techniques, see ACI 305 Guide to Hot Weather Concreting<div>';
					}
				}//end else
				
				//return tooltip string
				s+= '</div>'
				return s;
			},
		},
		
		//Plot Configuration
		plotOptions:
		{
			
			//Series Configurations
			series:
			{
				
				color: 'black',
				cursor: 'pointer',
				allowPointSelect: true,
				selected: true,
				
				point:
				{
					
					events:
					{
						mouseout: function()
						{
							this.chart.tooltip.hide();
						},
						
						click: function()
						{
							if (isProject) {
								notifTimeID = fullDate[this.x];
								seriesNotifID = this.series.name;
								//alert(this.series[0].id);
								
								
								//code
							
							document.getElementById("notiftitle").innerHTML = 'Add Notification for '+ fullDate[this.x];
							
							//riskZone = main.findRiskZone(this.y);
							 if (this.y <= 0.15)
							 {
								currentZone = 0;
								document.getElementById("notif1").innerHTML = 'Moderate Risk';
								document.getElementById("notif2").innerHTML = 'High Risk';
								document.getElementById("notif3").innerHTML = 'Moderate or High Risk';
							}
							
							 else if (this.y <= 0.20)
							 {
								currentZone = 1;
								document.getElementById("notif1").innerHTML = 'Low Risk';
								document.getElementById("notif2").innerHTML = 'High Risk';
								document.getElementById("notif3").innerHTML = 'Low or High Risk';
							}
							else
							{
								currentZone = 2;
								document.getElementById("notif1").innerHTML = 'Low Risk';
								document.getElementById("notif2").innerHTML = 'Moderate Risk';
								document.getElementById("notif3").innerHTML = 'Low or Moderate Risk';
							}
							
							
							$(document).ready(function(){
							$("#notificationModal").modal('show');}
							);}
						}
					}
				}
			},
		},

		//Credits disabled
		credits:
		{
			enabled: false
		},

		//Data - Evaporation rates for times
		series:
		[{
			name: 'Original Prediction',
			data: evapArray,
			lineWidth: 2,
			//id: 0
		}],

		lang:
		{
			download_key: 'Click here to download the graph',
			email_key: 'Click here to email the graph',
			print_key: 'Click here to print the graph'
			
		},
		
		navigation:
		{
			buttonOptions:
			{
				theme:
				{
					'stroke-width': 1,
					stroke: 'silver',
					states:
					{
						hover:
						{
							//fill: '#bada55'
						},
						select:
						{
							stroke: '#039',
							//fill: '#bada55'
						}
					}
				}
			},
        },
		
		//Exporting options. Added "Options" text next to export button.
		exporting:
		{
			buttons:
			{
				contextButton:
				{
					//text: "Options",
					//_titleKey: 'some_key',
					//x: -160,
					enabled: false

				},
				exportButton:
				{
					text: 'Download Graph',
					_titleKey: 'download_key',
					x: -168,
					y: yLevel,
					menuItems: Highcharts.getOptions().exporting.buttons.contextButton.menuItems.splice(2)
				},
				
				printButton:
				{
					text: 'Print Graph',
					_titleKey: 'print_key',
					x: -279,
					y: yLevel,
					onclick: function ()
					{

						this.print();
					}
				},
				
				emailButton:
				{
					text: 'Email Graph',
					_titleKey: 'email_key',
					x: -359,
					y: yLevel,
						onclick: function ()
						{
							$(document).ready(function(){
							$("#emailModal").modal('show');});
						}
					
				}
				/*
				customButton:
				{
					onclick: function ()
					{
						var chartN = $('#container').highcharts();
						chartN.series[1].hide();

					},
					text: 'Reset Graph',
					enabled: resetButton

				},
				*/

			}
		}
	});

	$("#ResetButton").click(function()
	{
		
		var chartN = $('#container').highcharts();
		chartN.redraw();
		for (var ii = 0; ii < arrayLength; ii++)
		{
			evapArray[ii] = originalEvapArray[ii];
			concTempArray[ii] = originalConcTempArray[ii];
			windSpeedArray[ii] = originalWindSpeedArray[ii];
			
			//Update chart
			
			//chartN.series[0].data[ii].update(evapArray[ii]);
			//chartN.series[0].update(chartN.series[0].data[ii].options);
			//chart.tooltip.refresh(chart.series[0].points[ii]);
		}
		
		//chart.series[0].setData(originalEvapArray)

		chartN.redraw();
		isOriginalGraph = true;
	});
	
	$("#sbutton").click(function()
	{
		
		cTemp = document.getElementById("concreteTemp").value;
		
		if (isMetric) {
			if (cTemp != '') {
				cTemp = parseFloat(cTemp).toFixed(2);
			}
			
		}
		else{
			if (cTemp != '') {
				//TODO handle if ctemp = 0 and in standard
				cTemp = parseInt(cTemp);
			}
		}
	
		
		windS = document.getElementById("windSpeed").value;
		
		if (cTemp < lowerBoundConcreteTemp && cTemp != '') {
			alert('Concrete temperature must be higher than '+ lowerBoundConcreteTemp + temperatureLabel);
		}
		else if (cTemp > upperBoundConcreteTemp && cTemp != '') {
			alert('Concrete temperature must be lower than than '+ upperBoundConcreteTemp + temperatureLabel);
		}
		else
		{
		
		seriesName = '';
		newEvapArray = [];
		seriesColor = 'rgba(1,1,1,1)';
		var chart = $('#container').highcharts();
		
		if (numberOfSeries == 1) {
			seriesColor = 'rgba(48,156,252,1)';
		}
		else if (numberOfSeries == 2) {
			seriesColor = 'rgba(176,115,7,1)';
		}
				else if (numberOfSeries == 3) {
			seriesColor = 'rgba(237,175,57,1)';
		}
				else if (numberOfSeries == 4) {
			seriesColor = 'rgba(212,52,194,1)';
		}
				else if (numberOfSeries == 5) {
			seriesColor = 'rgba(100,26,252,1)';
				}
				else if (numberOfSeries == 6) {
			seriesColor = 'rgba(251,133,13,1)';
		}
				else if (numberOfSeries == 7) {
			seriesColor = 'rgba(212,129,130,1)';
		}
				else {
			seriesColor = 'rgba(1,1,1,1)';
		}
		
		//If only outside is checked
		if (windS == 'Outside' && cTemp == '') {
			alert("Series already exists");
			
		}
	
		// Else if inside is checked and empy concrete temp
		else if (windS == 'Inside' && cTemp == '')
		{
			numberOfSeries = numberOfSeries + 1;
			//alert ('Inside Wind Speed');
			seriesName = 'Inside';
			for (i = 0; i < arrayLength; i++)
			{
				
				newEvapArray[i] = main.calculateEvap(airTempArray[i], humidityArray[i], insideWindSpeed[i], concTempArray[i]);
			}
			chart.addSeries({
				name: seriesName,
				data: newEvapArray,
				color: seriesColor,
				dashStyle: 'dot',
				lineWidth: 2
				
			}, false);
		}
		
		//Outisde checked and conc temp filled in
		else if (windS == 'Outside' && cTemp != '')
		{
			numberOfSeries = numberOfSeries + 1;
			//alert('Outside and conc temp fillled in');
			seriesName = 'Concrete temp ' + cTemp + ' ' + temperatureLabel + '<br>Outside Wind Speed';
			for (i = 0; i < arrayLength; i++)
			{
				newEvapArray[i] = main.calculateEvap(airTempArray[i], humidityArray[i], windSpeedArray[i], cTemp);
			}
			
			chart.addSeries({
				name: seriesName,
				data: newEvapArray,
				color: seriesColor,
				dashStyle: 'dot',
				lineWidth: 2,
			
			}, false);
		}
		
		//Inside true cTemp filled in
		else if (windS == 'Inside' && cTemp != '')
		{
			numberOfSeries = numberOfSeries + 1;
			//alert('Inside and ctemp filed in');
			seriesName = 'Concrete temp ' + cTemp + ' ' + temperatureLabel + '<br>Inside';
			cTempOffset = cTemp.length
			windOffset = 1;
			
			for (i = 0; i < arrayLength; i++)
			{
				newEvapArray[i] = main.calculateEvap(airTempArray[i], humidityArray[i], insideWindSpeed[i], cTemp);	
			}
			
			chart.addSeries({
				name: seriesName,
				data: newEvapArray,
				color: seriesColor,
				dashStyle: 'dot',
				lineWidth: 2
			}, false);
		}
		
		chart.redraw();
		
		
		}
		return false;
	});
	
	$("#addNotif").click(function()
	{
		var c = $('#container').highcharts();
		var notif = document.getElementById("notif").value;
		//alert('zone wanted= ' + notif + ' CurrentZone=' + currentZone + ' time=' + notifTimeID + ' projectID= '+ projectID + ' seriesID=' + seriesNotifID);
		
		//alert('Notification Added');
		
		$("#notifSuccess").show();
		$('#notificationModal').modal('toggle');
	});
	$("#notifSuccess").hide();
	$("#emailSuccess").hide();
	$('.alert .close').on('click', function(e)
	{
		$(this).parent().hide();
	});

	$("#emailGraph").click(function()
	{
		var c = $('#container').highcharts();
		var email = document.getElementById("email").value;
		var message = document.getElementById("message").value;
		var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
		
		//validate email
		if (email == '' || emailReg.test(email) == false) {
			alert('Invalid e-mail address');
		}
		
		//else send email
		else
		{
			var url = window.location.href;
			

			$("#emailSuccess").show();
			$('#emailModal').modal('toggle');
		}
	});
});


</script>

		

					
	
	<form class="form-horizontal" id="weatherChangeForm" action=none>
		<div class="form-group">
			
			<div class="row">
				
				<div class="col-xs-12 col-sm-4 col-md-5 col-lg-3">
					<label for="concreteTemp" class="col-xs-12 col-sm-7 col-md-6 col-lg-7 control-label">Concrete Temperature <span id= "cTempLabel"> " "</span></label>
					<div class="col-xs-12 col-sm-5 col-md-4 col-lg-5">
						<input type="number" class="form-control" id="concreteTemp" maxlength="3">
							
					</div>
					
					<label for="windSpeed" class="col-xs-12 col-sm-7 col-md-6 col-lg-7 control-label">Wind Speed</label>
					<div class="col-xs-12 col-sm-5 col-md-4 col-lg-5">
						<select  id="windSpeed" class="form-control">
							<option id = "Outside">Outside</option>
							<option id = "Inside">Inside</option>
						</select>
					</div>
					<div class="col-xs-offset-0 col-sm-offset-7 col-md-offset-6 col-lg-offset-7 col-xs-12">
						<button class="btn btn-primary"  type='button' id='sbutton'>Submit</button>
					</div>
				</div>
			</div>
		</div>
	</form>
	
</div>
<div id ="button"></div>

<div id="emailModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Email Graph</h4>
            </div>
            <div class="modal-body">
                <form onsubmit="return false;">
		<input class="form-control" id="email" type="text" placeholder='E-mail Address' required>

		<textarea name = "message" id = 'message' class="form-control" placeholder="Add message...." ></textarea>
            </div>
            <div class="modal-footer">
		<button type="button" class="btn btn-primary" id='emailGraph'>Send E-mail</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
	    </form>
	</div>
    </div>
</div>

<div id="notificationModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="a" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id = notiftitle>Add Notification</h4>
            </div>
            <div class="modal-body">
                <form>
			Receive an e-mail when the predicted risk changes to
		<select id='notif'> 
			<option id = notif1> </option>
			<option id = notif2> </option>
			<option id = notif3> </option>
		</select>
	    </div>
	    <div class = "modal-footer">
                <button type="button" class="btn btn-primary" id="addNotif" >Add Notification</button>
		<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		</form>
	    </div>  
            </div>
        </div>
    </div>






